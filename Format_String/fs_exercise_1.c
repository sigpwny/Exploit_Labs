#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define BUF_SIZE 12

/*
 * This is a test program to observe a format string vulnerability in printf.
 *
 * Explanation: printf sees a specifier and assumes it is sent in
 *		as a parameter. It blindly grabs data off the stack.
 *		We can read interesting data stored on the stack.
 *
 *
 *	NOTE: In this diagram, the stack grows up.
 *
 *	+-----------------------+ 0x0000
 *	|	...		|
 *	|-----------------------|
 *	|	local_var_2	|
 *	|-----------------------|
 *	| 	local_var_1	|
 *	|-----------------------|
 *	|	old ebp		| <--- base pointer of main()
 *	|-----------------------|
 *	| ret_addr to main	| <--- return address from printf() to main()
 *	|-----------------------|
 *	| format_str_addr	| <--- Param1: addr of format string to printf()
 *	|=======================|
 *	|	buf*		| <--- main() local variable
 *	|-----------------------|
 *	|	old ebp		| <--- old base pointer
 *	|-----------------------|
 *	| ret_addr to ???	| <--- return address to system
 *	|-----------------------|
 *	|	argc		| <--- Parameter 1 to main
 *	|-----------------------|
 *	|	argv[0]		| <--- Parameter 2 to main
 *	|-----------------------|
 *	|	argv[1]		| <--- Parameter 3 to main
 *	|-----------------------|
 *	|	...		|
 *	+-----------------------+ 0xFFFF
 *
*/
int main(int argc, char *argv[])
{
    if(argc != 2)
    {
	printf("To use this program: ./fs_exercise_1 <argument1>\n");
        return -1;
    }

    char *berf = "Secrets await.";
    char *duff = "Not quite.";
    char *buff = "This is not the string you're looking for.";
    char *buf = "You win!";

    printf(argv[1]);
    printf("\n");

    return 0;
}
